<div class="container card mt-4 pt-4 h-100">

    <div class="breadcrumb-container">

        <nav aria-label="breadcrumb">
            <ol class="breadcrumb breadcrumb-link">
                <li class="breadcrumb-item"><a [routerLink]="['/home']">Home</a></li>
                <li class="breadcrumb-item"><a [routerLink]="['/market-place']">MarketPlace</a></li>
                <li class="breadcrumb-item active" aria-current="page"><a [routerLink]="['/my-offers']">My Offers</a>
                </li>
            </ol>
        </nav>

    </div>

    <div class="d-flex gap-3 mt-4 mb-3">
        <div>
            <select class="form-select form-select fw-bold " [(ngModel)]="offerStatus" (change)="handleFilterList()">
                <option *ngFor="let list of offersFilterOptions" [value]="list.value"> {{list.label}}</option>
            </select>
        </div>
        <div *ngIf="offerStatus == 'Active' && allActiveProjects">
            <select class="form-select form-select fw-bold " [(ngModel)]="filterByProject" (change)="handleChange()">
                <option value="" disabled selected hidden>Filter by Project</option>
                <option value="all">Show All Projects</option>

                <option *ngFor="let project of allActiveProjects" [ngValue]="project"> {{project}}</option>

            </select>
        </div>

    </div>

    <table class="table">
        <thead>
            <tr>
                <th *ngFor="let item of offersColumns ; index as i " class="text-secondary "
                    [ngClass]="{'text-end': i > 0 }">{{item}}</th>
            </tr>
        </thead>
        <tbody class="my-listing-table-body" id="accordion">
            <ng-container *ngFor=" let offer of myOffers | paginate
            : {
                itemsPerPage: tableSize,
                currentPage: page,
                totalItems: count
              };
        let i = index">
                <tr class="text-end text-secondary">
                    <td class="text-start">{{offer.accountMpName}} / <span
                            class="pe-auto offer-td">{{offer.projectId}}</span></td>
                    <td class=""> {{offer.auctionEnd | date:'d MMM, y'}}</td>
                    <td>
                        {{offer.listedNMA}}
                    </td>
                    <td>{{(offer.auctionType == 'Fix Bid' &&
                        !offer.auctionType.endsWith('- Buy Immediately or Make Me an Offer')) ? 'N/A' :
                        offer.minimumAsk |
                        currency:'':'':'4.2-2'}}</td>
                    <td>{{ (offer.auctionType != 'Fix Bid' &&
                        !offer.auctionType.endsWith('- Buy Immediately or Make Me an Offer')) ? "N/A" :
                        offer.buyNowPrice |
                        currency:'':'':'4.2-2'}}</td>
                    <td>{{offer.noOfBids}}</td>
                    <td>{{offer.auctionType.startsWith('Silent -') ? 'silent' : offer.highestBid |
                        currency:'':'':'4.2-2'}}</td>
                    <td id="heading{{i}}">
                        <span data-toggle="collapse" [attr.data-target]="'#collapse'+i" aria-expanded="false"
                            [attr.aria-controls]="'collapse'+i" class="offer-td collapsed pe-auto" title="Offer details"
                            [ngClass]="{'highest-offer':(offer.isHighestOffer  &&
                            !offer.auctionType.startsWith('Silent -') && offer.offerAmount) , 'not-highest-offer' :
                            (!offer.isHighestOffer  && !offer.auctionType.startsWith('Silent -') && offer.offerAmount)  }"
                            (click)="handleListDetails(offer.listingId , offer.offer_id)">

                            {{!offer.offerAmount ? 'make offer':offer.offerAmount |
                            currency:'':'':'4.2-2'}}
                        </span>
                    </td>

                </tr>
                <tr id="collapse{{i}}" class=" collapse fade" [attr.aria-labelledby]="'heading'+i"
                    data-parent="#accordion">
                    <td colspan="8">

                        <div class="card-body">
                            <ul class="nav nav-tabs" id="myTab" role="tablist">
                                <li class="nav-item my-listing-item" role="presentation">
                                    <button class="nav-link active " id="listingDetails-tab{{i}}" data-bs-toggle="tab"
                                        [attr.data-bs-target]="'#listingDetails'+i" type="button" role="tab"
                                        [attr.aria-controls]="'listingDetails'+i" aria-selected="true">Listing
                                        Details</button>
                                </li>
                                <li class="nav-item my-listing-item" role="presentation">
                                    <button class="nav-link " id="myOffers-tab{{i}}" data-bs-toggle="tab"
                                        [attr.data-bs-target]="'#myOffers'+i" type="button" role="tab"
                                        [attr.aria-controls]="'myOffers'+i" aria-selected="false">My Offer
                                    </button>
                                </li>

                            </ul>

                            <div class="tab-content" id="myTabContent">
                                <div class="tab-pane fade show active " id="listingDetails{{i}}" role="tabpanel"
                                    [attr.aria-labelledby]="'listingDetails-tab'+i">

                                    <app-listing-details [listDetails]="listDetails">
                                    </app-listing-details>
                                </div>
                                <div class="tab-pane fade" id="myOffers{{i}}" role="tabpanel"
                                    [attr.aria-labelledby]="'myOffers-tab'+i">
                                    <app-my-offers [constraintOptions]="constraintOptions" [newOffer]="newOffer"
                                        [offer]="offer" [listDetails]="listDetails"
                                        (updateOffers)="handleUpdateOffers()">
                                    </app-my-offers>
                                </div>


                            </div>
                        </div>
                    </td>
                </tr>
            </ng-container>

        </tbody>
    </table>
    <div class="d-flex justify-content-center">
        <pagination-controls previousLabel="Prev" nextLabel="Next" (pageChange)="onTableDataChange($event)"
            *ngIf="handleLength(myOffers)">
        </pagination-controls>
    </div>

</div>