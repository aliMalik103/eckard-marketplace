<div class="row mt-4">
    <div class="col-md-4 col-sm-12">
        <label for="listednma" class="form-label fw-bold">Auction Type: <small class=" px-2">
                <ng-container
                    *ngIf="offer.auctionType.startsWith('Public -') || offer.auctionType.startsWith('Silent -') ; else elseBlock">
                    {{offer.auctionType.slice(8)}}
                </ng-container>
                <ng-template #elseBlock>
                    {{offer.auctionType}}
                </ng-template>
            </small></label>
    </div>
</div>
<div class="mt-3 row">
    <label for="Constraints" class="form-label fw-bold">Constraints / Contingencies</label>
    <div class="col-sm-10">

        <div class="form-check" *ngFor="let item of constraintOptions">
            <input class="form-check-input" type="checkbox" [(ngModel)]="item.isChecked" (change)="changeSelection()" [disabled]="(offer.offer_Status == 'Accepted')"
                [name]="item.constraint" [id]="'constraint'+item.id">
            <label  [for]="'constraint'+item.id">
                {{item.constraint}}
            </label>
        </div>
    </div>
</div>
<div class="mt-3 row">
    <label for="comments" class="form-label fw-bold">Comments</label>
    <textarea class="form-control" [(ngModel)]="newOffer.comments" id="comments" name="comments" rows="3" [disabled]="(offer.offer_Status == 'Accepted')"></textarea>
</div>

<div class="row mt-3">
    <div class="form-inline d-flex gap-5 p-0 ">

        <div class="form-group  mb-2">
            <label for="myoffer" class="col-form-label fw-bold">My Offer: </label>
            <input [(ngModel)]="newOffer.offerAmount" class="mx-2 form-control" id="offerAmount" name="offerAmount"
                currencyMask [options]="{ prefix: '$', thousands: ',',precision: 0, align:'left', allowNegative: false}"
                [disabled]="offer.auctionType == 'Fix Price'"
                [ngClass]="{'border border-danger': newOffer.offerAmount < offer.minimumAsk}">
            <small class="text-muted">({{(newOffer.offerAmount / offer.listedNMA) | currency:'':'':'.2-2'
                }}/NMA)</small>

        </div>
        <div class="d-flex gap-3">
            <button type="submit" class="btn btn-warning text-white fw-bold mb-2"
                [disabled]="newOffer.offerAmount < offer.minimumAsk" data-bs-toggle="modal"
                *ngIf="(offer.offer_Status != 'Accepted')"
                [attr.data-bs-target]="'#staticBackdrop'+index">
                {{offer.auctionType == "Fix Price" ? 'BUY NOW' : 'SUBMIT OFFER'}}</button>
            <button type="submit" class="btn btn-danger mb-2 fw-bold" data-bs-toggle="modal"
                [attr.data-bs-target]="'#exampleModal'+index"
                *ngIf="(newOffer.id && offer.auctionType != 'Fix Price' && offer.offer_Status != 'Cancelled')">CANCEL
                OFFER</button>
        </div>

    </div>
    <span *ngIf="newOffer.offerAmount < offer.minimumAsk" class="text-danger rounded px-4 error-message">
        Offer must be greater than Minimum Asking Price
    </span>
</div>
<div class="mt-5 row">
    <div class="col-12 p-0 d-flex">

        <div class="accordion accordion-flush col-10 pt-1" id="myOfferAccordion">
            <div class="accordion-item ">
                <h5 class="accordion-header collapsed p-0 est-cashflow " id="myOffer-headingOne" data-toggle="collapse"
                    data-target="#myOffer-collapseOne" aria-expanded="false" aria-controls="myOffer-collapseOne">
                    Basic CashFlow Calculator <sup>*)</sup>

                    <strong class="small float-end fw-bold est-cashflow" *ngIf="isRecalculate">
                        Est. CashFlow: {{ calculateTotalCashFlow |
                        currency:'CAD':'symbol-narrow':'.2-2'}}</strong>
                </h5>
                <div id="myOffer-collapseOne" class="accordion-collapse collapse pt-2"
                    aria-labelledby="myOffer-headingOne" data-parent="#myOfferAccordion">
                    <small class="px-3">*) using exponential decline curve with editable
                        parameters below
                    </small>
                    <div class="accordion-body  d-flex px-0 pt-4 w-100">
                        <div class="d-flex flex-column col">
                            <div>
                                <label for="noOfMonths" class="form-label"># of
                                    Months</label>

                                <input type="number" min="0" oninput="validity.valid||(value='');" class="form-control"
                                    aria-label="# of Months" [(ngModel)]="basicCashFlow.noOfMonths" id="noOfMonths"
                                    name="noOfMonths">
                            </div>

                        </div>
                        <div class="d-flex flex-column col">
                            <div>

                                <label for="expectedOutputDecline" class="form-label">Exp. Decline[%]
                                </label>

                                <input type="number" class="form-control" aria-label="Expected Output Decline(%)"
                                    min="0" [(ngModel)]="basicCashFlow.decline" id="decline" name="decline">
                            </div>

                        </div>
                        <div class="d-flex flex-column col">
                            <div>
                                <label for="oilPrice" class="form-label">Oil Price [BBL]
                                </label>

                                <input type="number" min="0" class="form-control" aria-label="Oil Price"
                                    [(ngModel)]="basicCashFlow.oilPrice" id="oilPrice" name="oilPrice">
                            </div>

                        </div>
                        <div class="d-flex flex-column col">
                            <div>

                                <label for="gasPrice" class="form-label">Gas Price [MCF]
                                </label>

                                <input type="number" min="0" class="form-control" aria-label="Gas Price"
                                    [(ngModel)]="basicCashFlow.gasPrice" id="gasPrice" name="gasPrice">

                            </div>

                        </div>

                        <div class=" m-auto col pt-3">
                            <span for="default"
                                class="form-label d-inline-block text-primary pe-auto border-bottom border-primary"
                                (click)="handleSaveAsDefault(basicCashFlow)">
                                Save as Default
                            </span>
                        </div>
                    </div>

                </div>
            </div>

        </div>


        <div class="col">
            <strong for="recalculate"
                class=" small est-cashflow  d-inline-block text-primary pe-auto border-bottom border-primary"
                (click)="handleCalculateCashFlow()">
                Re/Calculate
            </strong>
        </div>

    </div>
</div>

<!-- Button trigger modal -->
<!-- Modal -->
<div class="modal fade" id="staticBackdrop{{index}}" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
    aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="staticBackdropLabel">Buying Agreement and Confirmation</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                Are you sure you want to SUBMIT OFFER !
            </div>
            <div class="modal-footer">
                <div class="mr-auto ">

                    <button type="button" (click)="handleSubmitOffer(newOffer, offer)"
                        class="btn btn-warning text-white mr-2 fw-bold" data-bs-dismiss="modal">ACCEPT</button>
                    <button type="button" data-bs-dismiss="modal" class="btn btn-danger ml-2 fw-bold">CANCEL</button>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="exampleModal{{index}}" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
    aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="staticBackdropLabel">Offer Cancel Confirmation</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                Are you sure you want to CANCEL OFFER ?
            </div>
            <div class="modal-footer">
                <div class="mr-auto ">

                    <button type="button" class="btn btn-warning text-white mr-2 fw-bold" data-bs-dismiss="modal"
                        (click)="handleCancelOffer(newOffer)">YES</button>
                    <button type="button" class="btn btn-danger ml-2 fw-bold" data-bs-dismiss="modal">CANCEL</button>
                </div>
            </div>
        </div>
    </div>
</div>